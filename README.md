# REST Object Tree Generator

## Usage

### Generate

Prepare the new `rest/api/openapi.yaml` specification and generate the REST API source code.

```
npm run generate
```

You can easily define objects and tree branches in `config/config.yaml`.

Choose one of the predefined generators or create a new one in `src/generator/*.js`.

### Serve

Launch the REST API and its documentation:

```
npm run serve
```

## REST API Description

ðŸ“š Template {becomes} Draft {published on-chain to} Object.

You cannot **create** objects or object drafts directly.  

1.  `PUT /object/{objectName}/template/{templateId}/{objectId}/` to create a Draft inside Object (added if missing)

You cannot **update** objects or object versions directly.  

1.  `PUT /object/{objectName}/{objectId}/draft/{draftId}/` to publish Draft to Object (append to version chain)
2.  `PUT /object/{objectName}/{objectId}/version/{version}/` to revert Object to version (trim version chain)

Drafts are discarded after publishing.  
Schemas can only be created and modified in Templates.

|          | Template   | Draft       | Object                  |
|----------|------------|-------------|-------------------------|
| Data     | Editable   | Editable    | Read-only (versionized) |
| Schema   | Editable   | Read-only   | Read-only (versionized) |

Data migration is the same as user input so it must be handled at the application level, not at the API level:  

1.  `POST | GET /object/{objectName}/template/{templateId}/` - (once) Prepare new schema and default data
2.  `GET /object/{objectName}/{objectId}/` - Fetch current object data, schema and schema ID
3.  Inside application - migrate data using #1 and #2
4.  `PUT /object/{objectName}/template/{templateId}/{objectId}/` with **publish=true** - Update Object with new data & schema

Applications should display any schema.  
Data migration should be performed on user request.

* * *

**Trees** define relationships between Objects.  
Define branch structure using cardinality; use exclamation mark (`!`) for 1:

1.  **many-to-many** Example: `/tree/team/user`
2.  **one-to-many** Example: `/tree/organization!/team`
3.  **many-to-one** Example: `/tree/user/!level`
4.  **one-to-one** Example: `/tree/user!/!logo`

## Sample output

[This OpenAPI v3 specification](https://app.swaggerhub.com/apis/markjivko/bbox/0.0.1) is generated by 
default when first executing `npm run generate`.
